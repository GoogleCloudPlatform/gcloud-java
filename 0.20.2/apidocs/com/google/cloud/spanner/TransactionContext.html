<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (1.8.0_112-google-v7) on Mon Jul 17 14:42:35 PDT 2017 -->
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>TransactionContext (Google Cloud 0.20.2-alpha API)</title>
<meta name="date" content="2017-07-17">
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="TransactionContext (Google Cloud 0.20.2-alpha API)";
        }
    }
    catch(err) {
    }
//-->
var methods = {"i0":6,"i1":6};
var tabs = {65535:["t0","All Methods"],2:["t2","Instance Methods"],4:["t3","Abstract Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/TransactionContext.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../com/google/cloud/spanner/TimestampBound.Mode.html" title="enum in com.google.cloud.spanner"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../com/google/cloud/spanner/TransactionRunner.html" title="interface in com.google.cloud.spanner"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?com/google/cloud/spanner/TransactionContext.html" target="_top">Frames</a></li>
<li><a href="TransactionContext.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">com.google.cloud.spanner</div>
<h2 title="Interface TransactionContext" class="title">Interface TransactionContext</h2>
</div>
<div class="contentContainer">
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt>All Superinterfaces:</dt>
<dd><a href="http://docs.oracle.com/javase/7/docs/api/java/lang/AutoCloseable.html?is-external=true" title="class or interface in java.lang">AutoCloseable</a>, <a href="../../../../com/google/cloud/spanner/ReadContext.html" title="interface in com.google.cloud.spanner">ReadContext</a></dd>
</dl>
<hr>
<br>
<pre>public interface <span class="typeNameLabel">TransactionContext</span>
extends <a href="../../../../com/google/cloud/spanner/ReadContext.html" title="interface in com.google.cloud.spanner">ReadContext</a></pre>
<div class="block">Context for a single attempt of a locking read-write transaction. This type of transaction is the
 only way to write data into Cloud Spanner; <a href="../../../../com/google/cloud/spanner/DatabaseClient.html#write-java.lang.Iterable-"><code>DatabaseClient.write(Iterable)</code></a> and <a href="../../../../com/google/cloud/spanner/DatabaseClient.html#writeAtLeastOnce-java.lang.Iterable-"><code>DatabaseClient.writeAtLeastOnce(Iterable)</code></a> use transactions internally. These transactions rely on
 pessimistic locking and, if necessary, two-phase commit. Locking read-write transactions may
 abort, requiring the application to retry. However, the interface exposed by <a href="../../../../com/google/cloud/spanner/TransactionRunner.html" title="interface in com.google.cloud.spanner"><code>TransactionRunner</code></a> eliminates the need for applications to write retry loops explicitly.

 <p>Locking transactions may be used to atomically read-modify-write data anywhere in a database.
 This type of transaction is externally consistent.

 <p>Clients should attempt to minimize the amount of time a transaction is active. Faster
 transactions commit with higher probability and cause less contention. Cloud Spanner attempts to
 keep read locks active as long as the transaction continues to do reads, and the transaction has
 not been terminated by returning from a <a href="../../../../com/google/cloud/spanner/TransactionRunner.TransactionCallable.html" title="interface in com.google.cloud.spanner"><code>TransactionRunner.TransactionCallable</code></a>. Long
 periods of inactivity at the client may cause Cloud Spanner to release a transaction's locks and
 abort it.

 <p>Reads performed within a transaction acquire locks on the data being read. Writes can only be
 done at commit time, after all reads have been completed.

 <p>Conceptually, a read-write transaction consists of zero or more reads or SQL queries followed
 by a commit.

 <h3>Semantics</h3>

 <p>Cloud Spanner can commit the transaction if all read locks it acquired are still valid at
 commit time, and it is able to acquire write locks for all writes. Cloud Spanner can abort the
 transaction for any reason. If a commit attempt returns <code>ABORTED</code>, Cloud Spanner guarantees
 that the transaction has not modified any user data in Cloud Spanner.

 <p>Unless the transaction commits, Cloud Spanner makes no guarantees about how long the
 transaction's locks were held for. It is an error to use Cloud Spanner locks for any sort of
 mutual exclusion other than between Cloud Spanner transactions themselves.

 <h3>Retrying Aborted Transactions</h3>

 <p>When a transaction aborts, the application can choose to retry the whole transaction again. To
 maximize the chances of successfully committing the retry, the client should execute the retry in
 the same session as the original attempt. The original session's lock priority increases with
 each consecutive abort, meaning that each attempt has a slightly better chance of success than
 the previous.

 <p>Under some circumstances (e.g., many transactions attempting to modify the same row(s)), a
 transaction can abort many times in a short period before successfully committing. Thus, it is
 not a good idea to cap the number of retries a transaction can attempt; instead, it is better to
 limit the total amount of wall time spent retrying.

 <p>Application code does not need to retry explicitly; <a href="../../../../com/google/cloud/spanner/TransactionRunner.html" title="interface in com.google.cloud.spanner"><code>TransactionRunner</code></a> will
 automatically retry a transaction if an attempt results in an abort.

 <h3>Idle Transactions</h3>

 <p>A transaction is considered idle if it has no outstanding reads or SQL queries and has not
 started a read or SQL query within the last 10 seconds. Idle transactions can be aborted by Cloud
 Spanner so that they don't hold on to locks indefinitely. In that case, the commit will fail with
 error <code>ABORTED</code>.

 <p>If this behavior is undesirable, periodically executing a simple SQL query in the transaction
 (e.g., <code>SELECT 1</code>) prevents the transaction from becoming idle.</div>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../com/google/cloud/spanner/DatabaseClient.html#readWriteTransaction--"><code>DatabaseClient.readWriteTransaction()</code></a>, 
<a href="../../../../com/google/cloud/spanner/TransactionRunner.html" title="interface in com.google.cloud.spanner"><code>TransactionRunner</code></a></dd>
</dl>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ======== NESTED CLASS SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="nested.class.summary">
<!--   -->
</a>
<h3>Nested Class Summary</h3>
<ul class="blockList">
<li class="blockList"><a name="nested.classes.inherited.from.class.com.google.cloud.spanner.ReadContext">
<!--   -->
</a>
<h3>Nested classes/interfaces inherited from interface&nbsp;com.google.cloud.spanner.<a href="../../../../com/google/cloud/spanner/ReadContext.html" title="interface in com.google.cloud.spanner">ReadContext</a></h3>
<code><a href="../../../../com/google/cloud/spanner/ReadContext.QueryAnalyzeMode.html" title="enum in com.google.cloud.spanner">ReadContext.QueryAnalyzeMode</a></code></li>
</ul>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t2" class="tableTab"><span><a href="javascript:show(2);">Instance Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t3" class="tableTab"><span><a href="javascript:show(4);">Abstract Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../com/google/cloud/spanner/TransactionContext.html#buffer-java.lang.Iterable-">buffer</a></span>(<a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Iterable.html?is-external=true" title="class or interface in java.lang">Iterable</a>&lt;<a href="../../../../com/google/cloud/spanner/Mutation.html" title="class in com.google.cloud.spanner">Mutation</a>&gt;&nbsp;mutations)</code>
<div class="block">Buffers mutations to be applied if the transaction commits successfully.</div>
</td>
</tr>
<tr id="i1" class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../com/google/cloud/spanner/TransactionContext.html#buffer-com.google.cloud.spanner.Mutation-">buffer</a></span>(<a href="../../../../com/google/cloud/spanner/Mutation.html" title="class in com.google.cloud.spanner">Mutation</a>&nbsp;mutation)</code>
<div class="block">Buffers a single mutation to be applied if the transaction commits successfully.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods.inherited.from.class.com.google.cloud.spanner.ReadContext">
<!--   -->
</a>
<h3>Methods inherited from interface&nbsp;com.google.cloud.spanner.<a href="../../../../com/google/cloud/spanner/ReadContext.html" title="interface in com.google.cloud.spanner">ReadContext</a></h3>
<code><a href="../../../../com/google/cloud/spanner/ReadContext.html#analyzeQuery-com.google.cloud.spanner.Statement-com.google.cloud.spanner.ReadContext.QueryAnalyzeMode-">analyzeQuery</a>, <a href="../../../../com/google/cloud/spanner/ReadContext.html#close--">close</a>, <a href="../../../../com/google/cloud/spanner/ReadContext.html#executeQuery-com.google.cloud.spanner.Statement-com.google.cloud.spanner.Options.QueryOption...-">executeQuery</a>, <a href="../../../../com/google/cloud/spanner/ReadContext.html#read-java.lang.String-com.google.cloud.spanner.KeySet-java.lang.Iterable-com.google.cloud.spanner.Options.ReadOption...-">read</a>, <a href="../../../../com/google/cloud/spanner/ReadContext.html#readRow-java.lang.String-com.google.cloud.spanner.Key-java.lang.Iterable-">readRow</a>, <a href="../../../../com/google/cloud/spanner/ReadContext.html#readRowUsingIndex-java.lang.String-java.lang.String-com.google.cloud.spanner.Key-java.lang.Iterable-">readRowUsingIndex</a>, <a href="../../../../com/google/cloud/spanner/ReadContext.html#readUsingIndex-java.lang.String-java.lang.String-com.google.cloud.spanner.KeySet-java.lang.Iterable-com.google.cloud.spanner.Options.ReadOption...-">readUsingIndex</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="buffer-com.google.cloud.spanner.Mutation-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>buffer</h4>
<pre>void&nbsp;buffer(<a href="../../../../com/google/cloud/spanner/Mutation.html" title="class in com.google.cloud.spanner">Mutation</a>&nbsp;mutation)</pre>
<div class="block">Buffers a single mutation to be applied if the transaction commits successfully. The effects of
 this mutation will not be visible to subsequent operations in the transaction. All buffered
 mutations will be applied atomically.</div>
</li>
</ul>
<a name="buffer-java.lang.Iterable-">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>buffer</h4>
<pre>void&nbsp;buffer(<a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Iterable.html?is-external=true" title="class or interface in java.lang">Iterable</a>&lt;<a href="../../../../com/google/cloud/spanner/Mutation.html" title="class in com.google.cloud.spanner">Mutation</a>&gt;&nbsp;mutations)</pre>
<div class="block">Buffers mutations to be applied if the transaction commits successfully. The effects of the
 mutations will not be visible to subsequent operations in the transaction. All buffered
 mutations will be applied atomically.</div>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/TransactionContext.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../com/google/cloud/spanner/TimestampBound.Mode.html" title="enum in com.google.cloud.spanner"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../com/google/cloud/spanner/TransactionRunner.html" title="interface in com.google.cloud.spanner"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?com/google/cloud/spanner/TransactionContext.html" target="_top">Frames</a></li>
<li><a href="TransactionContext.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small>Copyright &#169; 2017 Google. All rights reserved.</small></p>
</body>
</html>
